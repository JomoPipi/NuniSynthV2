






import { NuniGraph } from "../nunigraph/model/nunigraph.js"
import { GraphController } from "../nunigraph/init.js"







function cycleGraph(input : string) {
    // GraphController.save()
    // GraphController.closeAllWindows()
    // GraphController.fromString(input)
    // GraphController.renderer.render()
    // return GraphController.g.toRawString()
}

const graphs = //[
    [ `{"connections":{"0":[],"12":[{"id":0,"connectionType":"channel"}],"14":[{"id":0,"connectionType":"channel"}]},"nodes":[{"id":0,"type":"gain","x":0.5067567567567568,"y":0.10909090909090909,"title":"OUTPUT","audioNode":{},"audioParamValues":{"gain":0.024324547002115282},"audioNodeProperties":{},"oldId":0},{"id":12,"type":"module","x":0.20270270270270271,"y":0.43636363636363634,"audioNode":{},"audioParamValues":{},"audioNodeProperties":{"graphCode":"{\"connections\":{\"2\":[{\"id\":3,\"connectionType\":\"channel\"},{\"id\":0,\"connectionType\":\"channel\"}],\"3\":[{\"id\":4,\"connectionType\":\"channel\"}],\"4\":[{\"id\":0,\"connectionType\":\"channel\"}],\"5\":[{\"id\":6,\"connectionType\":\"playbackRate\"}],\"6\":[{\"id\":4,\"connectionType\":\"pan\"}]},\"nodes\":[{\"id\":0,\"type\":\"gain\",\"x\":0.5102040816326531,\"y\":0.08,\"title\":\"OUTPUT\",\"audioNode\":{},\"audioParamValues\":{\"gain\":1},\"audioNodeProperties\":{},\"oldId\":0},{\"id\":2,\"type\":\"module\",\"x\":0.5102040816326531,\"y\":0.88,\"audioNode\":{},\"audioParamValues\":{},\"audioNodeProperties\":{\"graphCode\":\"{\\\"connections\\\":{\\\"1\\\":[{\\\"id\\\":2,\\\"connectionType\\\":\\\"channel\\\"}],\\\"2\\\":[{\\\"id\\\":0,\\\"connectionType\\\":\\\"channel\\\"}],\\\"3\\\":[{\\\"id\\\":1,\\\"connectionType\\\":\\\"frequency\\\"}],\\\"4\\\":[{\\\"id\\\":3,\\\"connectionType\\\":\\\"channel\\\"}]},\\\"nodes\\\":[{\\\"id\\\":0,\\\"type\\\":\\\"gain\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.10204081632653061,\\\"title\\\":\\\"OUTPUT\\\",\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"gain\\\":1},\\\"audioNodeProperties\\\":{},\\\"oldId\\\":0},{\\\"id\\\":1,\\\"type\\\":\\\"oscillator\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.5102040816326531,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"frequency\\\":440,\\\"detune\\\":0},\\\"audioNodeProperties\\\":{\\\"type\\\":\\\"sine\\\",\\\"kbMode\\\":false},\\\"oldId\\\":1},{\\\"id\\\":2,\\\"type\\\":\\\"subgraph-sequencer\\\",\\\"x\\\":0.17804154302670624,\\\"y\\\":0.30612244897959184,\\\"audioNode\\\":{\\\"stepMatrix\\\":{\\\"1\\\":[1,0,true,0,true,0,true,0]}},\\\"audioParamValues\\\":{},\\\"audioNodeProperties\\\":{\\\"subdiv\\\":8,\\\"isInSync\\\":true,\\\"nSteps\\\":8,\\\"adsrIndex\\\":2,\\\"phaseShift\\\":0},\\\"oldId\\\":2},{\\\"id\\\":3,\\\"type\\\":\\\"gain\\\",\\\"x\\\":0.17804154302670624,\\\"y\\\":0.7142857142857143,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"gain\\\":634.515182008939},\\\"audioNodeProperties\\\":{},\\\"oldId\\\":3},{\\\"id\\\":4,\\\"type\\\":\\\"buffer-sequencer\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.9183673469387755,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"playbackRate\\\":1,\\\"detune\\\":0},\\\"audioNodeProperties\\\":{\\\"subdiv\\\":6,\\\"isInSync\\\":true,\\\"nSteps\\\":3,\\\"adsrIndex\\\":3,\\\"stepMatrix\\\":{\\\"0\\\":[1,false,0],\\\"1\\\":[false,true,false]},\\\"phaseShift\\\":0,\\\"channelData\\\":{\\\"0\\\":{\\\"volume\\\":4.000000000000001,\\\"bufferKey\\\":0},\\\"1\\\":{\\\"volume\\\":4.000000000000001,\\\"bufferKey\\\":1}}},\\\"oldId\\\":4}]}\"},\"oldId\":2},{\"id\":3,\"type\":\"delay\",\"x\":0.30612244897959184,\"y\":0.72,\"audioNode\":{},\"audioParamValues\":{\"delayTime\":0.5},\"audioNodeProperties\":{},\"oldId\":3},{\"id\":4,\"type\":\"panner\",\"x\":0.7142857142857143,\"y\":0.72,\"audioNode\":{},\"audioParamValues\":{\"pan\":0},\"audioNodeProperties\":{},\"oldId\":4},{\"id\":5,\"type\":\"oscillator\",\"x\":0.7142857142857143,\"y\":0.56,\"audioNode\":{},\"audioParamValues\":{\"frequency\":0.10510225594043732,\"detune\":0},\"audioNodeProperties\":{\"type\":\"triangle\",\"kbMode\":false},\"oldId\":5},{\"id\":6,\"type\":\"buffer\",\"x\":0.30612244897959184,\"y\":0.56,\"audioNode\":{},\"audioParamValues\":{\"playbackRate\":1,\"detune\":0},\"audioNodeProperties\":{\"kbMode\":false,\"bufferKey\":0},\"oldId\":6}]}"},"oldId":12},{"id":14,"type":"module","x":0.8108108108108109,"y":0.43636363636363634,"audioNode":{},"audioParamValues":{},"audioNodeProperties":{"graphCode":"{\"connections\":{\"2\":[{\"id\":3,\"connectionType\":\"channel\"},{\"id\":0,\"connectionType\":\"channel\"}],\"3\":[{\"id\":4,\"connectionType\":\"channel\"}],\"4\":[{\"id\":0,\"connectionType\":\"channel\"}],\"5\":[{\"id\":6,\"connectionType\":\"playbackRate\"}],\"6\":[{\"id\":4,\"connectionType\":\"pan\"}]},\"nodes\":[{\"id\":0,\"type\":\"gain\",\"x\":0.5102040816326531,\"y\":0.08,\"title\":\"OUTPUT\",\"audioNode\":{},\"audioParamValues\":{\"gain\":1},\"audioNodeProperties\":{},\"oldId\":0},{\"id\":2,\"type\":\"module\",\"x\":0.5102040816326531,\"y\":0.88,\"audioNode\":{},\"audioParamValues\":{},\"audioNodeProperties\":{\"graphCode\":\"{\\\"connections\\\":{\\\"1\\\":[{\\\"id\\\":2,\\\"connectionType\\\":\\\"channel\\\"}],\\\"2\\\":[{\\\"id\\\":0,\\\"connectionType\\\":\\\"channel\\\"}],\\\"3\\\":[{\\\"id\\\":1,\\\"connectionType\\\":\\\"frequency\\\"}],\\\"4\\\":[{\\\"id\\\":3,\\\"connectionType\\\":\\\"channel\\\"}]},\\\"nodes\\\":[{\\\"id\\\":0,\\\"type\\\":\\\"gain\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.10204081632653061,\\\"title\\\":\\\"OUTPUT\\\",\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"gain\\\":1},\\\"audioNodeProperties\\\":{},\\\"oldId\\\":0},{\\\"id\\\":1,\\\"type\\\":\\\"oscillator\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.5102040816326531,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"frequency\\\":440,\\\"detune\\\":0},\\\"audioNodeProperties\\\":{\\\"type\\\":\\\"sine\\\",\\\"kbMode\\\":false},\\\"oldId\\\":1},{\\\"id\\\":2,\\\"type\\\":\\\"subgraph-sequencer\\\",\\\"x\\\":0.17804154302670624,\\\"y\\\":0.30612244897959184,\\\"audioNode\\\":{\\\"stepMatrix\\\":{\\\"1\\\":[1,0,true,0,true,0,true,0]}},\\\"audioParamValues\\\":{},\\\"audioNodeProperties\\\":{\\\"subdiv\\\":8,\\\"isInSync\\\":true,\\\"nSteps\\\":8,\\\"adsrIndex\\\":2,\\\"phaseShift\\\":0},\\\"oldId\\\":2},{\\\"id\\\":3,\\\"type\\\":\\\"gain\\\",\\\"x\\\":0.17804154302670624,\\\"y\\\":0.7142857142857143,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"gain\\\":634.515182008939},\\\"audioNodeProperties\\\":{},\\\"oldId\\\":3},{\\\"id\\\":4,\\\"type\\\":\\\"buffer-sequencer\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.9183673469387755,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"playbackRate\\\":1,\\\"detune\\\":0},\\\"audioNodeProperties\\\":{\\\"subdiv\\\":6,\\\"isInSync\\\":true,\\\"nSteps\\\":3,\\\"adsrIndex\\\":3,\\\"stepMatrix\\\":{\\\"0\\\":[1,false,0],\\\"1\\\":[false,true,false]},\\\"phaseShift\\\":0,\\\"channelData\\\":{\\\"0\\\":{\\\"volume\\\":4.000000000000001,\\\"bufferKey\\\":0},\\\"1\\\":{\\\"volume\\\":4.000000000000001,\\\"bufferKey\\\":1}}},\\\"oldId\\\":4}]}\"},\"oldId\":2},{\"id\":3,\"type\":\"delay\",\"x\":0.30612244897959184,\"y\":0.72,\"audioNode\":{},\"audioParamValues\":{\"delayTime\":0.5},\"audioNodeProperties\":{},\"oldId\":3},{\"id\":4,\"type\":\"panner\",\"x\":0.7142857142857143,\"y\":0.72,\"audioNode\":{},\"audioParamValues\":{\"pan\":0},\"audioNodeProperties\":{},\"oldId\":4},{\"id\":5,\"type\":\"oscillator\",\"x\":0.7142857142857143,\"y\":0.56,\"audioNode\":{},\"audioParamValues\":{\"frequency\":0.10510225594043732,\"detune\":0},\"audioNodeProperties\":{\"type\":\"triangle\",\"kbMode\":false},\"oldId\":5},{\"id\":6,\"type\":\"buffer\",\"x\":0.30612244897959184,\"y\":0.56,\"audioNode\":{},\"audioParamValues\":{\"playbackRate\":1,\"detune\":0},\"audioNodeProperties\":{\"kbMode\":false,\"bufferKey\":0},\"oldId\":6}]}"},"oldId":14}]}`
    
    ]
// `{"connections":{"0":[],"12":[{"id":0,"connectionType":"channel"}],"14":[{"id":0,"connectionType":"channel"}]},"nodes":[{"id":0,"type":"gain","x":0.5067567567567568,"y":0.10909090909090909,"title":"OUTPUT","audioNode":{},"audioParamValues":{"gain":0.024324547002115282},"audioNodeProperties":{},"oldId":0},{"id":12,"type":"module","x":0.20270270270270271,"y":0.43636363636363634,"audioNode":{},"audioParamValues":{},"audioNodeProperties":{"graphCode":"{\"connections\":{\"2\":[{\"id\":3,\"connectionType\":\"channel\"},{\"id\":0,\"connectionType\":\"channel\"}],\"3\":[{\"id\":4,\"connectionType\":\"channel\"}],\"4\":[{\"id\":0,\"connectionType\":\"channel\"}],\"5\":[{\"id\":6,\"connectionType\":\"playbackRate\"}],\"6\":[{\"id\":4,\"connectionType\":\"pan\"}]},\"nodes\":[{\"id\":0,\"type\":\"gain\",\"x\":0.5102040816326531,\"y\":0.08,\"title\":\"OUTPUT\",\"audioNode\":{},\"audioParamValues\":{\"gain\":1},\"audioNodeProperties\":{},\"oldId\":0},{\"id\":2,\"type\":\"module\",\"x\":0.5102040816326531,\"y\":0.88,\"audioNode\":{},\"audioParamValues\":{},\"audioNodeProperties\":{\"graphCode\":\"{\\\"connections\\\":{\\\"1\\\":[{\\\"id\\\":2,\\\"connectionType\\\":\\\"channel\\\"}],\\\"2\\\":[{\\\"id\\\":0,\\\"connectionType\\\":\\\"channel\\\"}],\\\"3\\\":[{\\\"id\\\":1,\\\"connectionType\\\":\\\"frequency\\\"}],\\\"4\\\":[{\\\"id\\\":3,\\\"connectionType\\\":\\\"channel\\\"}]},\\\"nodes\\\":[{\\\"id\\\":0,\\\"type\\\":\\\"gain\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.10204081632653061,\\\"title\\\":\\\"OUTPUT\\\",\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"gain\\\":1},\\\"audioNodeProperties\\\":{},\\\"oldId\\\":0},{\\\"id\\\":1,\\\"type\\\":\\\"oscillator\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.5102040816326531,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"frequency\\\":440,\\\"detune\\\":0},\\\"audioNodeProperties\\\":{\\\"type\\\":\\\"sine\\\",\\\"kbMode\\\":false},\\\"oldId\\\":1},{\\\"id\\\":2,\\\"type\\\":\\\"subgraph-sequencer\\\",\\\"x\\\":0.17804154302670624,\\\"y\\\":0.30612244897959184,\\\"audioNode\\\":{\\\"stepMatrix\\\":{\\\"1\\\":[1,0,true,0,true,0,true,0]}},\\\"audioParamValues\\\":{},\\\"audioNodeProperties\\\":{\\\"subdiv\\\":8,\\\"isInSync\\\":true,\\\"nSteps\\\":8,\\\"adsrIndex\\\":2,\\\"phaseShift\\\":0},\\\"oldId\\\":2},{\\\"id\\\":3,\\\"type\\\":\\\"gain\\\",\\\"x\\\":0.17804154302670624,\\\"y\\\":0.7142857142857143,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"gain\\\":634.515182008939},\\\"audioNodeProperties\\\":{},\\\"oldId\\\":3},{\\\"id\\\":4,\\\"type\\\":\\\"buffer-sequencer\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.9183673469387755,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"playbackRate\\\":1,\\\"detune\\\":0},\\\"audioNodeProperties\\\":{\\\"subdiv\\\":6,\\\"isInSync\\\":true,\\\"nSteps\\\":3,\\\"adsrIndex\\\":3,\\\"stepMatrix\\\":{\\\"0\\\":[1,false,0],\\\"1\\\":[false,true,false]},\\\"phaseShift\\\":0,\\\"channelData\\\":{\\\"0\\\":{\\\"volume\\\":4.000000000000001,\\\"bufferKey\\\":0},\\\"1\\\":{\\\"volume\\\":4.000000000000001,\\\"bufferKey\\\":1}}},\\\"oldId\\\":4}]}\"},\"oldId\":2},{\"id\":3,\"type\":\"delay\",\"x\":0.30612244897959184,\"y\":0.72,\"audioNode\":{},\"audioParamValues\":{\"delayTime\":0.5},\"audioNodeProperties\":{},\"oldId\":3},{\"id\":4,\"type\":\"panner\",\"x\":0.7142857142857143,\"y\":0.72,\"audioNode\":{},\"audioParamValues\":{\"pan\":0},\"audioNodeProperties\":{},\"oldId\":4},{\"id\":5,\"type\":\"oscillator\",\"x\":0.7142857142857143,\"y\":0.56,\"audioNode\":{},\"audioParamValues\":{\"frequency\":0.10510225594043732,\"detune\":0},\"audioNodeProperties\":{\"type\":\"triangle\",\"kbMode\":false},\"oldId\":5},{\"id\":6,\"type\":\"buffer\",\"x\":0.30612244897959184,\"y\":0.56,\"audioNode\":{},\"audioParamValues\":{\"playbackRate\":1,\"detune\":0},\"audioNodeProperties\":{\"kbMode\":false,\"bufferKey\":0},\"oldId\":6}]}"},"oldId":12},{"id":14,"type":"module","x":0.8108108108108109,"y":0.43636363636363634,"audioNode":{},"audioParamValues":{},"audioNodeProperties":{"graphCode":"{\"connections\":{\"2\":[{\"id\":3,\"connectionType\":\"channel\"},{\"id\":0,\"connectionType\":\"channel\"}],\"3\":[{\"id\":4,\"connectionType\":\"channel\"}],\"4\":[{\"id\":0,\"connectionType\":\"channel\"}],\"5\":[{\"id\":6,\"connectionType\":\"playbackRate\"}],\"6\":[{\"id\":4,\"connectionType\":\"pan\"}]},\"nodes\":[{\"id\":0,\"type\":\"gain\",\"x\":0.5102040816326531,\"y\":0.08,\"title\":\"OUTPUT\",\"audioNode\":{},\"audioParamValues\":{\"gain\":1},\"audioNodeProperties\":{},\"oldId\":0},{\"id\":2,\"type\":\"module\",\"x\":0.5102040816326531,\"y\":0.88,\"audioNode\":{},\"audioParamValues\":{},\"audioNodeProperties\":{\"graphCode\":\"{\\\"connections\\\":{\\\"1\\\":[{\\\"id\\\":2,\\\"connectionType\\\":\\\"channel\\\"}],\\\"2\\\":[{\\\"id\\\":0,\\\"connectionType\\\":\\\"channel\\\"}],\\\"3\\\":[{\\\"id\\\":1,\\\"connectionType\\\":\\\"frequency\\\"}],\\\"4\\\":[{\\\"id\\\":3,\\\"connectionType\\\":\\\"channel\\\"}]},\\\"nodes\\\":[{\\\"id\\\":0,\\\"type\\\":\\\"gain\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.10204081632653061,\\\"title\\\":\\\"OUTPUT\\\",\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"gain\\\":1},\\\"audioNodeProperties\\\":{},\\\"oldId\\\":0},{\\\"id\\\":1,\\\"type\\\":\\\"oscillator\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.5102040816326531,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"frequency\\\":440,\\\"detune\\\":0},\\\"audioNodeProperties\\\":{\\\"type\\\":\\\"sine\\\",\\\"kbMode\\\":false},\\\"oldId\\\":1},{\\\"id\\\":2,\\\"type\\\":\\\"subgraph-sequencer\\\",\\\"x\\\":0.17804154302670624,\\\"y\\\":0.30612244897959184,\\\"audioNode\\\":{\\\"stepMatrix\\\":{\\\"1\\\":[1,0,true,0,true,0,true,0]}},\\\"audioParamValues\\\":{},\\\"audioNodeProperties\\\":{\\\"subdiv\\\":8,\\\"isInSync\\\":true,\\\"nSteps\\\":8,\\\"adsrIndex\\\":2,\\\"phaseShift\\\":0},\\\"oldId\\\":2},{\\\"id\\\":3,\\\"type\\\":\\\"gain\\\",\\\"x\\\":0.17804154302670624,\\\"y\\\":0.7142857142857143,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"gain\\\":634.515182008939},\\\"audioNodeProperties\\\":{},\\\"oldId\\\":3},{\\\"id\\\":4,\\\"type\\\":\\\"buffer-sequencer\\\",\\\"x\\\":0.5341246290801187,\\\"y\\\":0.9183673469387755,\\\"audioNode\\\":{},\\\"audioParamValues\\\":{\\\"playbackRate\\\":1,\\\"detune\\\":0},\\\"audioNodeProperties\\\":{\\\"subdiv\\\":6,\\\"isInSync\\\":true,\\\"nSteps\\\":3,\\\"adsrIndex\\\":3,\\\"stepMatrix\\\":{\\\"0\\\":[1,false,0],\\\"1\\\":[false,true,false]},\\\"phaseShift\\\":0,\\\"channelData\\\":{\\\"0\\\":{\\\"volume\\\":4.000000000000001,\\\"bufferKey\\\":0},\\\"1\\\":{\\\"volume\\\":4.000000000000001,\\\"bufferKey\\\":1}}},\\\"oldId\\\":4}]}\"},\"oldId\":2},{\"id\":3,\"type\":\"delay\",\"x\":0.30612244897959184,\"y\":0.72,\"audioNode\":{},\"audioParamValues\":{\"delayTime\":0.5},\"audioNodeProperties\":{},\"oldId\":3},{\"id\":4,\"type\":\"panner\",\"x\":0.7142857142857143,\"y\":0.72,\"audioNode\":{},\"audioParamValues\":{\"pan\":0},\"audioNodeProperties\":{},\"oldId\":4},{\"id\":5,\"type\":\"oscillator\",\"x\":0.7142857142857143,\"y\":0.56,\"audioNode\":{},\"audioParamValues\":{\"frequency\":0.10510225594043732,\"detune\":0},\"audioNodeProperties\":{\"type\":\"triangle\",\"kbMode\":false},\"oldId\":5},{\"id\":6,\"type\":\"buffer\",\"x\":0.30612244897959184,\"y\":0.56,\"audioNode\":{},\"audioParamValues\":{\"playbackRate\":1,\"detune\":0},\"audioNodeProperties\":{\"kbMode\":false,\"bufferKey\":0},\"oldId\":6}]}"},"oldId":14}]}`
test_graph_copy: {
    let passed = 0, failed = 0
    for (const code1 of graphs) {
        const code2 = cycleGraph(code1)
        // const g = new NuniGraph()
        // log('0')
        // g.fromRawString(graphJSON)
        // log('1')
        // const code1 = g.toRawString()
        // log('2')
        // g.fromRawString(code1)
        // log('3')
        // const code2 = g.toRawString()
        // log('4')

        
        // if (code1 !== code2) { 
        //     failed++
        // } else {
        //     passed++
        // }
    }
    console.log(`${passed}/${passed + failed} tests passed`)
}