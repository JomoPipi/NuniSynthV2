<!DOCTYPE html>
<html>
<head>
  <title>NuniSynth Update Sage</title>
</head>
<body>
  <div style="border-bottom:blue"> Current version: </div>
  <span id="version" style="color:purple;font-size:20px">vX.Y.Z</span>
  <div id="container">
    <div id='downloadMessages'>
      <div id="progressBar"></div>
      <span id="downloadMessagesText"></span>
    </div>
  </div>
  <style>
    #progressBar {
      /* background-color: #bfb; */
      background-color: transparent;
      width: 0px;
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      /* border: 2px solid red; */
      backdrop-filter: hue-rotate(180deg);
      box-shadow: 0px 0px 3px 1px rgba(89, 0, 255, 0.432);
    }
    #downloadMessages {
      /* border: 1px solid purple; */
      background-color: #fbb;
      position: relative;
      padding: 4px;
      border-radius: 3px;
      margin-top: 10px;
      display: none;
    }
  </style>
<script>
// Display the current version
const version = window.location.hash.substring(1);
document.getElementById('version').innerText = version;

function update(percent) {
  console.log('p =',percent)
  progressBar.style.width = percent + '%'
  // downloadMessages.style.background = 
  // `linear-gradient(0.25turn, #bfb ${percent}%, #fbb ${100 - percent}%)`
}
container.appendChild(downloadMessages)
// Listen for messages
const { ipcRenderer } = require('electron');
ipcRenderer.on('message', function(event, text) {
  if (Array.isArray(text) && text[0].startsWith("Download speed: "))
  {
    const [str, percent] = text
    downloadMessagesText.innerText = str
    downloadMessages.style.display = 'block'
    update(percent)
  }
  else
  {
    console.log('message =',message)
    const message = document.createElement('div');
    message.innerText = text;
    container.appendChild(message);
  }
})
</script>
</body>
</html>